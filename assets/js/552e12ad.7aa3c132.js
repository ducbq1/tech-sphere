"use strict";(self.webpackChunktech_sphere=self.webpackChunktech_sphere||[]).push([[8200],{903:(n,c,t)=>{t.r(c),t.d(c,{assets:()=>l,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>e,toc:()=>o});var e=t(4266),i=t(4848),h=t(8453);const r={slug:"abac",title:"Ki\u1ec3m So\xe1t Truy C\u1eadp D\u1ef1a Tr\xean Thu\u1ed9c T\xednh \u0110\u01a1n Gi\u1ea3n V\u1edbi Spring Security",authors:["ducbq1"],tags:["abac","java","spring"]},s="Ki\u1ec3m So\xe1t Truy C\u1eadp D\u1ef1a Tr\xean Thu\u1ed9c T\xednh \u0110\u01a1n Gi\u1ea3n V\u1edbi Spring Security",l={authorsImageUrls:[void 0]},o=[{value:"Gi\u1edbi Thi\u1ec7u",id:"gi\u1edbi-thi\u1ec7u",level:2},{value:"ABAC l\xe0 g\xec?",id:"abac-l\xe0-g\xec",level:2},{value:"Spring Security v\xe0 SpEL",id:"spring-security-v\xe0-spel",level:2},{value:"Th\xe0nh Ph\u1ea7n Ch\xednh",id:"th\xe0nh-ph\u1ea7n-ch\xednh",level:2},{value:"C\xe1c th\xe0nh ph\u1ea7n ch\xednh trong ph\u01b0\u01a1ng ph\xe1p n\xe0y bao g\u1ed3m:",id:"c\xe1c-th\xe0nh-ph\u1ea7n-ch\xednh-trong-ph\u01b0\u01a1ng-ph\xe1p-n\xe0y-bao-g\u1ed3m",level:3},{value:"<code>PermissionEvaluator</code>",id:"permissionevaluator",level:3},{value:"<code>ContextAwarePolicyEnforcement</code>",id:"contextawarepolicyenforcement",level:3},{value:"<code>PolicyEnforcement</code>",id:"policyenforcement",level:3},{value:"<code>PolicyDefinition</code>",id:"policydefinition",level:3},{value:"<code>PolicyRule</code>",id:"policyrule",level:3},{value:"<code>SecurityAccessContext</code>",id:"securityaccesscontext",level:3}];function u(n){const c={blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,h.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.h2,{id:"gi\u1edbi-thi\u1ec7u",children:"Gi\u1edbi Thi\u1ec7u"}),"\n",(0,i.jsxs)(c.p,{children:['B\u1ea1n \u0111\xe3 t\u1eebng l\xe0m vi\u1ec7c tr\xean ph\u1ea7n m\u1ec1m m\xe0 c\xe1c quy t\u1eafc truy c\u1eadp kh\xf4ng ch\u1ec9 d\u1ef1a tr\xean vai tr\xf2 c\u1ee7a ng\u01b0\u1eddi d\xf9ng m\xe0 c\xf2n d\u1ef1a tr\xean th\u1ef1c th\u1ec3 c\u1ee5 th\u1ec3 m\xe0 vai tr\xf2 \u0111\xf3 \u0111\u01b0\u1ee3c c\u1ea5p quy\u1ec1n ch\u01b0a?\nV\xed d\u1ee5 nh\u01b0 "Qu\u1ea3n l\xfd d\u1ef1 \xe1n c\xf3 th\u1ec3 th\xeam ng\u01b0\u1eddi d\xf9ng v\xe0o ',(0,i.jsx)(c.strong,{children:"D\u1ef0 \xc1N C\u1ee6A H\u1ecc"}),'", "Nh\xe2n vi\xean c\u1eeda h\xe0ng c\xf3 th\u1ec3 truy c\u1eadp th\xf4ng tin ',(0,i.jsx)(c.strong,{children:"C\u1eecA H\xc0NG C\u1ee6A H\u1ecc"}),'", ho\u1eb7c "Ch\u1ee7 s\u1edf h\u1eefu t\xe0i li\u1ec7u c\xf3 th\u1ec3 ch\u1ec9nh s\u1eeda ',(0,i.jsx)(c.strong,{children:"T\xc0I LI\u1ec6U C\u1ee6A H\u1ecc"}),'"?']}),"\n",(0,i.jsxs)(c.p,{children:['Ho\u1eb7c, n\u01a1i c\xe1c quy t\u1eafc truy c\u1eadp d\u1ef1a tr\xean ng\u1eef c\u1ea3nh, nh\u01b0 th\u1eddi gian, m\u1ea1ng ng\u01b0\u1eddi d\xf9ng, ho\u1eb7c k\xeanh truy c\u1eadp (nh\u01b0 trang web, \u1ee9ng d\u1ee5ng di \u0111\u1ed9ng, h\u1ec7 th\u1ed1ng n\u1ed9i b\u1ed9, v.v.).\nV\xed d\u1ee5, "T\xe0i nguy\xean n\xe0y ch\u1ec9 c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c truy c\u1eadp ',(0,i.jsx)(c.strong,{children:"TRONG GI\u1edc H\xc0NH CH\xcdNH"})," ho\u1eb7c ",(0,i.jsx)(c.strong,{children:"CH\u1ec8 T\u1eea M\u1ea0NG N\u1ed8I B\u1ed8"}),'"?']}),"\n",(0,i.jsx)(c.p,{children:"T\u1ea5t c\u1ea3 nh\u1eefng \u0111i\u1ec1u \u0111\xf3, v\xe0 v\u1eabn c\u1ea7n logic c\u1ee7a c\xe1c quy t\u1eafc truy c\u1eadp n\xe0y c\xf3 th\u1ec3 c\u1ea5u h\xecnh v\xe0 linh ho\u1ea1t \u0111\u1ec3 \u0111\u01b0\u1ee3c s\u1eeda \u0111\u1ed5i v\u1edbi \xedt (ho\u1eb7c kh\xf4ng) m\xe3 h\xf3a ph\u1ea7n m\u1ec1m ho\u1eb7c tri\u1ec3n khai m\u1edbi."}),"\n",(0,i.jsxs)(c.p,{children:["N\u1ebfu v\u1eady, b\u1ea1n c\xf3 th\u1ec3 th\u1ea5y ",(0,i.jsx)(c.strong,{children:"Ki\u1ec3m So\xe1t Truy C\u1eadp D\u1ef1a Tr\xean Thu\u1ed9c T\xednh (Attribute-Based Access Control - ABAC)"})," r\u1ea5t h\u1eefu \xedch."]}),"\n",(0,i.jsx)(c.hr,{}),"\n",(0,i.jsx)(c.h2,{id:"abac-l\xe0-g\xec",children:"ABAC l\xe0 g\xec?"}),"\n",(0,i.jsx)(c.p,{children:"M\u1ecdi y\xeau c\u1ea7u truy c\u1eadp s\u1ebd c\xf3 b\u1ed1n y\u1ebfu t\u1ed1 (ch\u1ee7 th\u1ec3, t\xe0i nguy\xean, h\xe0nh \u0111\u1ed9ng v\xe0 m\xf4i tr\u01b0\u1eddng), trong \u0111\xf3:"}),"\n",(0,i.jsxs)(c.ul,{children:["\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.strong,{children:"Ch\u1ee7 th\u1ec3"}),": th\u1ef1c th\u1ec3 (th\u01b0\u1eddng l\xe0 ng\u01b0\u1eddi d\xf9ng) y\xeau c\u1ea7u truy c\u1eadp."]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.strong,{children:"T\xe0i nguy\xean"}),": \u0111\u1ed1i t\u01b0\u1ee3ng m\xe0 ch\u1ee7 th\u1ec3 mu\u1ed1n truy c\u1eadp."]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.strong,{children:"H\xe0nh \u0111\u1ed9ng"}),": thao t\xe1c m\xe0 ch\u1ee7 th\u1ec3 mu\u1ed1n th\u1ef1c hi\u1ec7n tr\xean t\xe0i nguy\xean."]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.strong,{children:"M\xf4i tr\u01b0\u1eddng"}),": b\u1ed1i c\u1ea3nh c\u1ee7a y\xeau c\u1ea7u truy c\u1eadp (th\u1eddi gian, v\u1ecb tr\xed, ph\u01b0\u01a1ng th\u1ee9c truy c\u1eadp, v.v.)."]}),"\n"]}),"\n",(0,i.jsxs)(c.p,{children:[(0,i.jsx)(c.strong,{children:"ABAC"})," cho ph\xe9p ho\u1eb7c t\u1eeb ch\u1ed1i truy c\u1eadp d\u1ef1a tr\xean c\xe1c thu\u1ed9c t\xednh c\u1ee7a c\xe1c y\u1ebfu t\u1ed1 n\xe0y."]}),"\n",(0,i.jsx)(c.p,{children:"V\xed d\u1ee5, m\u1ed9t quy t\u1eafc c\xf3 th\u1ec3 l\xe0:"}),"\n",(0,i.jsxs)(c.blockquote,{children:["\n",(0,i.jsx)(c.p,{children:"\"Cho ph\xe9p truy c\u1eadp n\u1ebfu vai tr\xf2 c\u1ee7a ng\u01b0\u1eddi d\xf9ng l\xe0 'Qu\u1ea3n l\xfd d\u1ef1 \xe1n' v\xe0 ID d\u1ef1 \xe1n trong y\xeau c\u1ea7u kh\u1edbp v\u1edbi ID d\u1ef1 \xe1n m\xe0 ng\u01b0\u1eddi d\xf9ng qu\u1ea3n l\xfd\"."}),"\n"]}),"\n",(0,i.jsx)(c.hr,{}),"\n",(0,i.jsx)(c.h2,{id:"spring-security-v\xe0-spel",children:"Spring Security v\xe0 SpEL"}),"\n",(0,i.jsx)(c.p,{children:"Spring Security cho ph\xe9p c\xe1c nh\xe0 ph\xe1t tri\u1ec3n ti\xeam logic ki\u1ec3m so\xe1t truy c\u1eadp c\u1ee7a h\u1ecd v\xe0o m\u1ed9t th\xe0nh ph\u1ea7n t\u1eadp trung v\xe0 \u0111\u01b0\u1ee3c th\u1ef1c thi (s\u1eed d\u1ee5ng ki\u1ec3m so\xe1t truy c\u1eadp d\u1ef1a tr\xean bi\u1ec3u th\u1ee9c) t\u1ea1i nhi\u1ec1u \u0111i\u1ec3m th\u1ef1c thi kh\xe1c nhau c\u1ee7a \u1ee9ng d\u1ee5ng, nh\u01b0 tr\u01b0\u1edbc/sau c\xe1c cu\u1ed9c g\u1ecdi REST API v\xe0 ph\u01b0\u01a1ng th\u1ee9c. N\xf3 cung c\u1ea5p t\u1ea5t c\u1ea3 ng\u1eef c\u1ea3nh c\u1ea7n thi\u1ebft (tham s\u1ed1 ph\u01b0\u01a1ng th\u1ee9c ho\u1eb7c \u0111\u1ed1i t\u01b0\u1ee3ng tr\u1ea3 v\u1ec1) \u0111\u1ec3 \xe1p d\u1ee5ng logic ki\u1ec3m so\xe1t truy c\u1eadp."}),"\n",(0,i.jsx)(c.p,{children:"SpEL (Spring Expression Language) l\xe0 m\u1ed9t ng\xf4n ng\u1eef bi\u1ec3u th\u1ee9c t\u01b0\u01a1ng t\u1ef1 nh\u01b0 Java EL, v\xe0 \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng trong Spring Security \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a c\xe1c bi\u1ec3u th\u1ee9c truy c\u1eadp."}),"\n",(0,i.jsx)(c.h2,{id:"th\xe0nh-ph\u1ea7n-ch\xednh",children:"Th\xe0nh Ph\u1ea7n Ch\xednh"}),"\n",(0,i.jsx)(c.p,{children:"Ph\u01b0\u01a1ng ph\xe1p \u0111\u01b0\u1ee3c tr\xecnh b\xe0y trong b\xe0i vi\u1ebft n\xe0y d\u1ef1a tr\xean c\xe1c \xfd t\u01b0\u1edfng sau:"}),"\n",(0,i.jsxs)(c.ul,{children:["\n",(0,i.jsxs)(c.li,{children:["S\u1eed d\u1ee5ng c\xe1c bi\u1ec3u th\u1ee9c Spring EL ki\u1ec3u boolean \u0111\u1ec3 \u0111\u1ecbnh ngh\u0129a c\xe1c quy t\u1eafc truy c\u1eadp (v\xed d\u1ee5: ",(0,i.jsx)(c.code,{children:"subject.project.id == resource.project.id"}),"), c\xe1c bi\u1ec3u th\u1ee9c n\xe0y s\u1ebd \u0111\u01b0\u1ee3c l\u01b0u tr\u1eef trong m\u1ed9t kho trung t\xe2m (v\xed d\u1ee5: b\u1ed9 nh\u1edb, c\u01a1 s\u1edf d\u1eef li\u1ec7u, LDAP, t\u1ec7p)."]}),"\n",(0,i.jsx)(c.li,{children:"\u0110\u1ecbnh ngh\u0129a m\u1ed9t th\xe0nh ph\u1ea7n t\u1eadp trung c\xf3 nhi\u1ec7m v\u1ee5 t\u1ea3i c\xe1c quy t\u1eafc, bao b\u1ecdc c\xe1c y\u1ebfu t\u1ed1 trong ng\u1eef c\u1ea3nh truy c\u1eadp, v\xe0 \u0111\xe1nh gi\xe1 c\xe1c bi\u1ec3u th\u1ee9c quy t\u1eafc \u0111\u1ec3 quy\u1ebft \u0111\u1ecbnh xem truy c\u1eadp c\xf3 \u0111\u01b0\u1ee3c cho ph\xe9p hay kh\xf4ng."}),"\n",(0,i.jsxs)(c.li,{children:["S\u1eed d\u1ee5ng c\xe1c annotation c\u1ee7a Spring nh\u01b0 ",(0,i.jsx)(c.code,{children:"@PostAuthorize"})," / ",(0,i.jsx)(c.code,{children:'@PreAuthorize("hasPermission(...)")'})," (c\xf9ng v\u1edbi c\xe1c th\xe0nh ph\u1ea7n kh\xe1c \u0111\u01b0\u1ee3c \u0111\u1ec1 c\u1eadp sau) \u0111\u1ec3 th\u1ef1c thi c\xe1c quy t\u1eafc truy c\u1eadp."]}),"\n"]}),"\n",(0,i.jsx)(c.h3,{id:"c\xe1c-th\xe0nh-ph\u1ea7n-ch\xednh-trong-ph\u01b0\u01a1ng-ph\xe1p-n\xe0y-bao-g\u1ed3m",children:"C\xe1c th\xe0nh ph\u1ea7n ch\xednh trong ph\u01b0\u01a1ng ph\xe1p n\xe0y bao g\u1ed3m:"}),"\n",(0,i.jsx)(c.hr,{}),"\n",(0,i.jsx)(c.h3,{id:"permissionevaluator",children:(0,i.jsx)(c.code,{children:"PermissionEvaluator"})}),"\n",(0,i.jsxs)(c.p,{children:["\u0110\xe2y l\xe0 \u0111i\u1ec3m \u0111\u1ea7u v\xe0o \u0111\u1ec3 th\u1ef1c thi logic ABAC. Nh\u01b0 \u0111\xe3 \u0111\u1ec1 c\u1eadp tr\u01b0\u1edbc \u0111\xf3, t\u1ea5t c\u1ea3 c\xe1c quy\u1ebft \u0111\u1ecbnh truy c\u1eadp \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n b\u1edfi Spring Security (theo m\xf4 h\xecnh ki\u1ec3m so\xe1t truy c\u1eadp d\u1ef1a tr\xean bi\u1ec3u th\u1ee9c) \u0111\u1ec1u \u0111\u01b0\u1ee3c \u1ee7y quy\u1ec1n cho th\xe0nh ph\u1ea7n n\xe0y. T\u1ee9c l\xe0, t\u1ea5t c\u1ea3 c\xe1c annotation nh\u01b0 ",(0,i.jsx)(c.code,{children:'@PreAuthorize("hasPermission(...)")'}),", ",(0,i.jsx)(c.code,{children:'@PostAuthorize("hasPermission(...)")'})," s\u1ebd \u0111\u01b0\u1ee3c chuy\u1ec3n \u0111\u1ebfn th\xe0nh ph\u1ea7n n\xe0y \u0111\u1ec3 x\u1eed l\xfd."]}),"\n",(0,i.jsxs)(c.p,{children:["Ph\u01b0\u01a1ng ph\xe1p \u0111\u01b0\u1ee3c tr\xecnh b\xe0y \u1edf \u0111\xe2y t\u1ea1o ra m\u1ed9t l\u1edbp tri\u1ec3n khai t\xf9y ch\u1ec9nh c\u1ee7a th\xe0nh ph\u1ea7n ",(0,i.jsx)(c.code,{children:"PermissionEvaluator"}),", l\u1edbp n\xe0y \u0111\u01a1n gi\u1ea3n ch\u1ec9 \u1ee7y quy\u1ec1n vi\u1ec7c \u0111\u01b0a ra quy\u1ebft \u0111\u1ecbnh truy c\u1eadp cho th\xe0nh ph\u1ea7n ",(0,i.jsx)(c.code,{children:"PolicyEnforcement"}),"."]}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-java",children:'public class AbacPermissionEvaluator implements PermissionEvaluator {\n    @Autowired\n    PolicyEnforcement policy;\n\n    @Override\n    public boolean hasPermission(Authentication authentication , Object targetDomainObject, Object permission) {\n        //Getting subject\n        Object user = authentication.getPrincipal();\n\n        //Getting environment\n        Map<String, Object> environment = new HashMap<>();\n        environment.put("time", new Date());\n\n        return policy.check(user, targetDomainObject, permission, environment);\n    }\n\n    @Override\n    public boolean hasPermission(Authentication authentication, Serializable targetId, String targetType, Object permission) {\n        return false;\n    }\n}\n'})}),"\n",(0,i.jsx)(c.h3,{id:"contextawarepolicyenforcement",children:(0,i.jsx)(c.code,{children:"ContextAwarePolicyEnforcement"})}),"\n",(0,i.jsxs)(c.p,{children:["\u0110\xe2y l\xe0 m\u1ed9t th\xe0nh ph\u1ea7n t\xf9y ch\u1ecdn, t\u01b0\u01a1ng t\u1ef1 nh\u01b0 ",(0,i.jsx)(c.code,{children:"PermissionEvaluator"}),", nh\u01b0ng c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c g\u1ecdi t\u1ea1i  ",(0,i.jsx)(c.strong,{children:"b\u1ea5t k\u1ef3 \u0111\xe2u trong m\xe3 ngu\u1ed3n"})," , mi\u1ec5n l\xe0 ",(0,i.jsx)(c.code,{children:"SecurityContext"})," \u0111\xe3 \u0111\u01b0\u1ee3c kh\u1edfi t\u1ea1o v\xe0 ch\u1ee9a th\xf4ng tin x\xe1c th\u1ef1c c\u1ee7a ng\u01b0\u1eddi d\xf9ng hi\u1ec7n t\u1ea1i."]}),"\n",(0,i.jsxs)(c.p,{children:["Th\xe0nh ph\u1ea7n n\xe0y \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng trong nh\u1eefng tr\u01b0\u1eddng h\u1ee3p m\xe0 ",(0,i.jsx)(c.strong,{children:"d\u1eef li\u1ec7u c\u1ea7n thi\u1ebft \u0111\u1ec3 \u0111\u01b0a ra quy\u1ebft \u0111\u1ecbnh truy c\u1eadp kh\xf4ng s\u1eb5n c\xf3"})," cho c\xe1c annotation ",(0,i.jsx)(c.code,{children:"@PreAuthorize"})," v\xe0 ",(0,i.jsx)(c.code,{children:"@PostAuthorize"}),"."]}),"\n",(0,i.jsx)(c.p,{children:"V\xed d\u1ee5, trong tr\u01b0\u1eddng h\u1ee3p c\u1eadp nh\u1eadt m\u1ed9t th\u1ef1c th\u1ec3:"}),"\n",(0,i.jsxs)(c.ul,{children:["\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.code,{children:"@PreAuthorize"})," ch\u1ec9 c\xf3 th\u1ec3 truy c\u1eadp v\xe0o  ",(0,i.jsx)(c.strong,{children:"c\xe1c tham s\u1ed1 truy\u1ec1n v\xe0o ph\u01b0\u01a1ng th\u1ee9c"})," , t\u1ee9c l\xe0 d\u1eef li\u1ec7u c\u1ee7a th\u1ef1c th\u1ec3 sau khi c\u1eadp nh\u1eadt, trong khi quy\u1ebft \u0111\u1ecbnh truy c\u1eadp l\u1ea1i ",(0,i.jsx)(c.strong,{children:"ph\u1ee5 thu\u1ed9c v\xe0o d\u1eef li\u1ec7u c\u1ee7a th\u1ef1c th\u1ec3 hi\u1ec7n c\xf3"})," trong h\u1ec7 th\u1ed1ng."]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.code,{children:"@PostAuthorize"})," s\u1ebd \u0111\u01b0\u1ee3c g\u1ecdi  ",(0,i.jsx)(c.strong,{children:"sau khi qu\xe1 tr\xecnh c\u1eadp nh\u1eadt ho\xe0n t\u1ea5t"})," , \u0111i\u1ec1u n\xe0y l\xe0  ",(0,i.jsx)(c.strong,{children:"qu\xe1 mu\u1ed9n \u0111\u1ec3 th\u1ef1c hi\u1ec7n ki\u1ec3m tra quy\u1ec1n truy c\u1eadp"})," ."]}),"\n"]}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-java",children:'public class ContextAwarePolicyEnforcement {\n    @Autowired\n    protected PolicyEnforcement policy;\n\n    public void checkPermission(Object resource, String permission) {\n        //Getting the subject\n        Authentication auth = SecurityContextHolder.getContext().getAuthentication();\n\n        //Getting the environment\n        Map<String, Object> environment = new HashMap<>();\n        environment.put("time", new Date());\n\n        if(!policy.check(auth.getPrincipal(), resource, permission, environment))\n        throw new AccessDeniedException("Access is denied");\n    }\n}\n'})}),"\n",(0,i.jsx)(c.h3,{id:"policyenforcement",children:(0,i.jsx)(c.code,{children:"PolicyEnforcement"})}),"\n",(0,i.jsxs)(c.p,{children:["\u0110\xe2y l\xe0 n\u01a1i  ",(0,i.jsx)(c.strong,{children:"quy\u1ebft \u0111\u1ecbnh truy c\u1eadp th\u1ef1c s\u1ef1 \u0111\u01b0\u1ee3c \u0111\u01b0a ra"})," . C\u01a1 ch\u1ebf ho\u1ea1t \u0111\u1ed9ng nh\u01b0 sau:"]}),"\n",(0,i.jsxs)(c.ol,{children:["\n",(0,i.jsxs)(c.li,{children:[(0,i.jsxs)(c.strong,{children:["T\u1ea3i t\u1ea5t c\u1ea3 c\xe1c ",(0,i.jsx)(c.code,{children:"PolicyRule"})]})," th\xf4ng qua ",(0,i.jsx)(c.code,{children:"PolicyDefinition"}),"."]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsxs)(c.strong,{children:["L\u1ecdc c\xe1c ",(0,i.jsx)(c.code,{children:"PolicyRule"})]})," \u0111\u1ec3 ch\u1ec9 gi\u1eef l\u1ea1i nh\u1eefng quy t\u1eafc ",(0,i.jsx)(c.strong,{children:"c\xf3 th\u1ec3 \xe1p d\u1ee5ng"})," (t\u1ee9c l\xe0 c\xe1c quy t\u1eafc m\xe0 bi\u1ec3u th\u1ee9c ",(0,i.jsx)(c.code,{children:"target"})," \u0111\u01b0\u1ee3c \u0111\xe1nh gi\xe1 l\xe0 ",(0,i.jsx)(c.code,{children:"true"}),") trong ng\u1eef c\u1ea3nh truy c\u1eadp hi\u1ec7n t\u1ea1i."]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsxs)(c.strong,{children:["\u0110\xe1nh gi\xe1 t\u1ea5t c\u1ea3 c\xe1c ",(0,i.jsx)(c.code,{children:"PolicyRule"})," \xe1p d\u1ee5ng \u0111\u01b0\u1ee3c"]})," (t\u1ee9c l\xe0 \u0111\xe1nh gi\xe1 bi\u1ec3u th\u1ee9c \u0111i\u1ec1u ki\u1ec7n) trong ng\u1eef c\u1ea3nh truy c\u1eadp hi\u1ec7n t\u1ea1i. N\u1ebfu  ",(0,i.jsxs)(c.strong,{children:["b\u1ea5t k\u1ef3 bi\u1ec3u th\u1ee9c n\xe0o tr\u1ea3 v\u1ec1 ",(0,i.jsx)(c.code,{children:"true"})]})," , quy\u1ec1n truy c\u1eadp s\u1ebd \u0111\u01b0\u1ee3c c\u1ea5p;  ",(0,i.jsx)(c.strong,{children:"ng\u01b0\u1ee3c l\u1ea1i"})," , truy c\u1eadp s\u1ebd b\u1ecb t\u1eeb ch\u1ed1i."]}),"\n"]}),"\n",(0,i.jsxs)(c.blockquote,{children:["\n",(0,i.jsxs)(c.p,{children:["L\xfd do m\xe0 ch\xfang ta ",(0,i.jsxs)(c.strong,{children:["kh\xf4ng hi\u1ec7n th\u1ef1c logic n\xe0y tr\u1ef1c ti\u1ebfp trong ",(0,i.jsx)(c.code,{children:"PermissionEvaluator"})]})," l\xe0 \u0111\u1ec3  ",(0,i.jsx)(c.strong,{children:"t\xe1ch bi\u1ec7t logic ABAC kh\u1ecfi Spring Security"})," , v\xe0 cho ph\xe9p vi\u1ec7c \u0111\u01b0a ra quy\u1ebft \u0111\u1ecbnh c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c g\u1ecdi ",(0,i.jsx)(c.strong,{children:"ngo\xe0i ph\u1ea1m vi Spring Security Framework"})," (v\xed d\u1ee5: b\u1eb1ng c\xe1ch g\u1ecdi tr\u1ef1c ti\u1ebfp ",(0,i.jsx)(c.code,{children:"PolicyEnforcement"})," trong b\u1ea5t k\u1ef3 logic n\xe0o c\u1ee7a ph\u01b0\u01a1ng th\u1ee9c)."]}),"\n"]}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-java",children:'public class BasicPolicyEnforcement implements PolicyEnforcement {\n    @Autowired\n    private PolicyDefinition policyDefinition;\n\n    @Override\n    public boolean check(Object subject, Object resource, Object action, Object environment) {\n        //Get all policy rules\n        List<PolicyRule> allRules = policyDefinition.getAllPolicyRules();\n\n        //Wrap the context\n        SecurityAccessContext cxt = new SecurityAccessContext(subject, resource, action, environment);\n\n        //Filter the rules according to context.\n        List<PolicyRule> matchedRules = filterRules(allRules, cxt);\n\n        //finally, check if any of the rules are satisfied, otherwise return false.\n        return checkRules(matchedRules, cxt);\n    }\n\n    private List<PolicyRule> filterRules(List<PolicyRule> allRules, SecurityAccessContext cxt) {\n        List<PolicyRule> matchedRules = new ArrayList<>();\n        for(PolicyRule rule : allRules) {\n            try {\n                if(rule.getTarget().getValue(cxt, Boolean.class)) {\n                    matchedRules.add(rule);\n                }\n            } catch(EvaluationException ex) {\n                logger.error("An error occurred while evaluating PolicyRule.", ex);\n            }\n        }\n        return matchedRules;\n    }\n\n    private boolean checkRules(List<PolicyRule> matchedRules, SecurityAccessContext cxt) {\n        for(PolicyRule rule : matchedRules) {\n            try {\n                if(rule.getCondition().getValue(cxt, Boolean.class)) {\n                    return true;\n                }\n            } catch(EvaluationException ex) {\n                logger.error("An error occurred while evaluating PolicyRule.", ex);\n            }\n        }\n        return false;\n    }\n}\n'})}),"\n",(0,i.jsx)(c.hr,{}),"\n",(0,i.jsx)(c.h3,{id:"policydefinition",children:(0,i.jsx)(c.code,{children:"PolicyDefinition"})}),"\n",(0,i.jsxs)(c.p,{children:["\u0110\xe2y l\xe0  ",(0,i.jsxs)(c.strong,{children:["interface \u0111\u1ea1i di\u1ec7n cho kho l\u01b0u tr\u1eef ",(0,i.jsx)(c.code,{children:"PolicyRule"})]})," . N\xf3 ch\u1ec9 c\xf3 m\u1ed9t ph\u01b0\u01a1ng th\u1ee9c duy nh\u1ea5t l\xe0 ",(0,i.jsx)(c.code,{children:"getAllPolicyRules"}),", d\xf9ng \u0111\u1ec3 t\u1ea3i t\u1ea5t c\u1ea3 c\xe1c quy t\u1eafc truy c\u1eadp hi\u1ec7n c\xf3."]}),"\n",(0,i.jsxs)(c.p,{children:["Interface n\xe0y gi\xfap ",(0,i.jsx)(c.strong,{children:"\u1ea9n \u0111i chi ti\u1ebft v\u1ec1 c\xe1ch l\u01b0u tr\u1eef c\xe1c quy t\u1eafc truy c\u1eadp"})," \u0111\u1ed1i v\u1edbi c\xe1c client s\u1eed d\u1ee5ng policy. Th\xe0nh ph\u1ea7n n\xe0y c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c hi\u1ec7n th\u1ef1c cho (nh\u01b0ng kh\xf4ng gi\u1edbi h\u1ea1n \u1edf): policy l\u01b0u trong b\u1ed9 nh\u1edb (",(0,i.jsx)(c.code,{children:"in-memory"}),"), file JSON, ho\u1eb7c c\u01a1 s\u1edf d\u1eef li\u1ec7u. C\xe1ch th\u1ee9c l\u01b0u tr\u1eef c\u1ee5 th\u1ec3 s\u1ebd do b\xean tri\u1ec3n khai th\xe0nh ph\u1ea7n n\xe0y quy\u1ebft \u0111\u1ecbnh."]}),"\n",(0,i.jsx)(c.hr,{}),"\n",(0,i.jsx)(c.h3,{id:"policyrule",children:(0,i.jsx)(c.code,{children:"PolicyRule"})}),"\n",(0,i.jsxs)(c.p,{children:["\u0110\xe2y l\xe0 ",(0,i.jsx)(c.strong,{children:"th\xe0nh ph\u1ea7n nguy\xean t\u1eed (atomic)"})," c\u1ee7a m\u1ed9t ch\xednh s\xe1ch truy c\u1eadp \u2013 n\u01a1i ",(0,i.jsx)(c.strong,{children:"\u0111\u1ecbnh ngh\u0129a logic ABAC"})," s\u1ebd \u0111\u01b0\u1ee3c \u0111\xe1nh gi\xe1 khi c\u1ea7n thi\u1ebft."]}),"\n",(0,i.jsxs)(c.p,{children:[(0,i.jsx)(c.code,{children:"PolicyRule"})," c\xf3 c\xe1c thu\u1ed9c t\xednh ch\xednh sau:"]}),"\n",(0,i.jsxs)(c.ul,{children:["\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.code,{children:"target"}),": M\u1ed9t bi\u1ec3u th\u1ee9c boolean s\u1eed d\u1ee5ng SpEL (Spring Expression Language) x\xe1c \u0111\u1ecbnh khi n\xe0o quy t\u1eafc n\xe0y ",(0,i.jsx)(c.strong,{children:"c\xf3 hi\u1ec7u l\u1ef1c"})," (n\u1ebfu bi\u1ec3u th\u1ee9c \u0111\xe1nh gi\xe1 l\xe0 ",(0,i.jsx)(c.code,{children:"true"}),", th\xec quy t\u1eafc s\u1ebd \u0111\u01b0\u1ee3c \xe1p d\u1ee5ng)."]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.code,{children:"condition"}),": M\u1ed9t bi\u1ec3u th\u1ee9c boolean SpEL x\xe1c \u0111\u1ecbnh khi n\xe0o quy t\u1eafc n\xe0y ",(0,i.jsx)(c.strong,{children:"\u0111\u01b0\u1ee3c tho\u1ea3 m\xe3n"})," (n\u1ebfu bi\u1ec3u th\u1ee9c \u0111\xe1nh gi\xe1 l\xe0 ",(0,i.jsx)(c.code,{children:"true"}),", th\xec truy c\u1eadp s\u1ebd \u0111\u01b0\u1ee3c cho ph\xe9p)."]}),"\n"]}),"\n",(0,i.jsxs)(c.p,{children:["C\u1ea3 hai bi\u1ec3u th\u1ee9c tr\xean \u0111\u1ec1u ",(0,i.jsx)(c.strong,{children:"c\xf3 quy\u1ec1n truy c\u1eadp \u0111\u1ebfn b\u1ed1n th\xe0nh ph\u1ea7n"})," trong y\xeau c\u1ea7u truy c\u1eadp: ",(0,i.jsx)(c.code,{children:"subject"})," (\u0111\u1ed1i t\u01b0\u1ee3ng), ",(0,i.jsx)(c.code,{children:"resource"})," (t\xe0i nguy\xean), ",(0,i.jsx)(c.code,{children:"action"})," (h\xe0nh \u0111\u1ed9ng), v\xe0 ",(0,i.jsx)(c.code,{children:"environment"})," (m\xf4i tr\u01b0\u1eddng)."]}),"\n",(0,i.jsxs)(c.blockquote,{children:["\n",(0,i.jsxs)(c.p,{children:["\u0110\u1ec3 \u0111\u01a1n gi\u1ea3n h\xf3a, c\xe1c ",(0,i.jsx)(c.code,{children:"Rule"})," m\u1eb7c \u0111\u1ecbnh ch\u1ec9 c\xf3 ",(0,i.jsx)(c.strong,{children:"t\xe1c d\u1ee5ng t\xedch c\u1ef1c"})," (t\u1ee9c l\xe0 cho ph\xe9p truy c\u1eadp n\u1ebfu \u0111\u01b0\u1ee3c th\u1ecfa m\xe3n), nh\u01b0ng ch\xfang c\xf3 th\u1ec3 \u0111\u01b0\u1ee3c m\u1edf r\u1ed9ng d\u1ec5 d\xe0ng \u0111\u1ec3 c\xf3 ",(0,i.jsx)(c.strong,{children:"t\xe1c d\u1ee5ng ti\xeau c\u1ef1c"})," (t\u1ee9c l\xe0 t\u1eeb ch\u1ed1i truy c\u1eadp n\u1ebfu \u0111\u01b0\u1ee3c th\u1ecfa m\xe3n)."]}),"\n"]}),"\n",(0,i.jsx)(c.hr,{}),"\n",(0,i.jsx)(c.h3,{id:"securityaccesscontext",children:(0,i.jsx)(c.code,{children:"SecurityAccessContext"})}),"\n",(0,i.jsxs)(c.p,{children:["\u0110\xe2y l\xe0 m\u1ed9t ",(0,i.jsx)(c.strong,{children:"l\u1edbp wrapper"})," ch\u1ee9a t\u1ea5t c\u1ea3 c\xe1c th\xe0nh ph\u1ea7n c\u1ee7a m\u1ed9t y\xeau c\u1ea7u truy c\u1eadp. N\xf3 c\xf3 c\xe1c thu\u1ed9c t\xednh t\u01b0\u01a1ng \u1ee9ng v\u1edbi t\u1eebng th\xe0nh ph\u1ea7n: ",(0,i.jsx)(c.code,{children:"Subject"}),", ",(0,i.jsx)(c.code,{children:"Resource"}),", ",(0,i.jsx)(c.code,{children:"Action"}),", v\xe0 ",(0,i.jsx)(c.code,{children:"Environment"}),"."]}),"\n",(0,i.jsxs)(c.p,{children:["\u0110\u1ed1i v\u1edbi m\u1ed7i quy\u1ebft \u0111\u1ecbnh truy c\u1eadp c\u1ea7n th\u1ef1c hi\u1ec7n, m\u1ed9t ",(0,i.jsx)(c.strong,{children:"instance"})," c\u1ee7a l\u1edbp n\xe0y s\u1ebd \u0111\u01b0\u1ee3c t\u1ea1o b\u1edfi ",(0,i.jsx)(c.code,{children:"PolicyEnforcement"})," v\xe0 \u0111\u01b0\u1ee3c ",(0,i.jsx)(c.strong,{children:"g\xe1n c\xe1c gi\xe1 tr\u1ecb t\u01b0\u01a1ng \u1ee9ng"})," v\u1edbi y\xeau c\u1ea7u truy c\u1eadp hi\u1ec7n t\u1ea1i."]}),"\n",(0,i.jsxs)(c.p,{children:["C\xe1c instance n\xe0y s\u1ebd \u0111\xf3ng vai tr\xf2 l\xe0 ",(0,i.jsx)(c.strong,{children:"\u0111\u1ed1i t\u01b0\u1ee3ng g\u1ed1c (Root Object)"})," \u0111\u1ec3 \u0111\xe1nh gi\xe1 c\xe1c bi\u1ec3u th\u1ee9c trong ",(0,i.jsx)(c.code,{children:"PolicyRule"}),"."]})]})}function d(n={}){const{wrapper:c}={...(0,h.R)(),...n.components};return c?(0,i.jsx)(c,{...n,children:(0,i.jsx)(u,{...n})}):u(n)}},4266:n=>{n.exports=JSON.parse('{"permalink":"/tech-sphere/blog/abac","editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/blog/2025-04-08-abac.md","source":"@site/blog/2025-04-08-abac.md","title":"Ki\u1ec3m So\xe1t Truy C\u1eadp D\u1ef1a Tr\xean Thu\u1ed9c T\xednh \u0110\u01a1n Gi\u1ea3n V\u1edbi Spring Security","description":"Gi\u1edbi Thi\u1ec7u","date":"2025-04-08T00:00:00.000Z","tags":[{"inline":true,"label":"abac","permalink":"/tech-sphere/blog/tags/abac"},{"inline":true,"label":"java","permalink":"/tech-sphere/blog/tags/java"},{"inline":true,"label":"spring","permalink":"/tech-sphere/blog/tags/spring"}],"readingTime":8.44,"hasTruncateMarker":false,"authors":[{"name":"B\xf9i Quang \u0110\u1ee9c","title":"CV ph\xe1t tri\u1ec3n \u1ee9ng d\u1ee5ng | P.PTUD giao d\u1ecbch CN & QTNB - Tr\u1ee5 s\u1edf ch\xednh VietinBank","url":"https://github.com/ducbq1","page":{"permalink":"/tech-sphere/blog/authors/ducbq-1"},"socials":{"x":"https://x.com/ducbq1","github":"https://github.com/ducbq1"},"imageURL":"/tech-sphere/avatar/ducbq1.jpg","key":"ducbq1"}],"frontMatter":{"slug":"abac","title":"Ki\u1ec3m So\xe1t Truy C\u1eadp D\u1ef1a Tr\xean Thu\u1ed9c T\xednh \u0110\u01a1n Gi\u1ea3n V\u1edbi Spring Security","authors":["ducbq1"],"tags":["abac","java","spring"]},"unlisted":false,"nextItem":{"title":"CQRS (Command Query Responsibility Segregation)","permalink":"/tech-sphere/blog/cqrs"}}')},8453:(n,c,t)=>{t.d(c,{R:()=>r,x:()=>s});var e=t(6540);const i={},h=e.createContext(i);function r(n){const c=e.useContext(h);return e.useMemo((function(){return"function"==typeof n?n(c):{...c,...n}}),[c,n])}function s(n){let c;return c=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),e.createElement(h.Provider,{value:c},n.children)}}}]);