---
slug: angular
title: Best Practices trong Angular (kÃ¨m RxJS)
authors: [ducbq1]
tags: [angular, frontend]
---
# ğŸ“š Best Practices trong Angular (kÃ¨m RxJS)

## ğŸ“ 1. Cáº¥u trÃºc Dá»± Ãn RÃµ RÃ ng

Chia theo module tÃ­nh nÄƒng (feature-based).

```bash
/src/app/
  â”œâ”€â”€ auth/
  â”œâ”€â”€ dashboard/
  â”œâ”€â”€ shared/     # component, pipe dÃ¹ng chung
  â””â”€â”€ core/       # services singleton
```

## ğŸ§© 2. Module HÃ³a ÄÃºng CÃ¡ch

- **SharedModule**: chá»©a component, pipe, directive dÃ¹ng chung.
- **CoreModule**: chá»©a cÃ¡c singleton service nhÆ° auth, logger,...
- **LÆ°u Ã½**: CoreModule chá»‰ import trong AppModule.

## â™»ï¸ 3. Sá»­ dá»¥ng RxJS ÄÃºng CÃ¡ch

### ğŸ” Há»§y Subscription khi khÃ´ng dÃ¹ng ná»¯a

```ts
private destroy$ = new Subject<void>();

ngOnDestroy() {
  this.destroy$.next();
  this.destroy$.complete();
}

this.service.getData()
  .pipe(takeUntil(this.destroy$))
  .subscribe(...);
```

### âœ… DÃ¹ng async pipe trong template

```html
<div *ngIf="data$ | async as data">{{ data }}</div>
```

## ğŸš¨ 4. Xá»­ LÃ½ Lá»—i RxJS (Error Handling)

```ts
this.api.getData().pipe(
  catchError((err) => {
    this.logger.error(err);
    return of([]); // fallback
  })
);
```

- Sá»­ dá»¥ng **HttpInterceptor** Ä‘á»ƒ xá»­ lÃ½ lá»—i táº­p trung (toÃ n cá»¥c).

## ğŸ§  5. Smart Component vs Dumb Component

| Loáº¡i Component | Chá»©c NÄƒng                          |
| -------------- | ---------------------------------- |
| Smart          | Gá»i API, xá»­ lÃ½ logic, state        |
| Dumb           | Hiá»ƒn thá»‹, nháº­n @Input(), @Output() |

## ğŸ’¬ 6. Dá»‹ch Vá»¥ (Services) PhÃ¢n Táº§ng

- Logic gá»i API, state... nÃªn Ä‘á»ƒ trong service.
- Component chá»‰ dÃ¹ng Ä‘á»ƒ giao tiáº¿p vá»›i UI.

## ğŸ”’ 7. Báº£o Máº­t

- KhÃ´ng lÆ°u thÃ´ng tin nháº¡y cáº£m vÃ o `localStorage` hoáº·c `sessionStorage`.
- Sá»­ dá»¥ng **CanActivate**, **CanLoad** Ä‘á»ƒ báº£o vá»‡ route.

## ğŸ” 8. DRY & Reusability

- Táº¡o directive, pipe, vÃ  component nhá» Ä‘á»ƒ tÃ¡i sá»­ dá»¥ng.
- Háº¡n cháº¿ láº·p láº¡i code trong template.

## ğŸš€ 9. Tá»‘i Æ¯u Hiá»‡u NÄƒng

```ts
@Component({
  changeDetection: ChangeDetectionStrategy.OnPush
})
```

- TrÃ¡nh dÃ¹ng `.map()`, `.filter()` trong template.

## ğŸ§ª 10. Testing

- **Unit Test**: Component, Service, Pipe...
- **E2E Test**: Cypress, Playwright (hoáº·c Protractor náº¿u cÅ©)

---

# ğŸ“¦ RxJS Operators Tá»•ng Há»£p

## âœ… Táº¡o Observable

| TÃªn            | MÃ´ táº£                           |
| -------------- | ------------------------------- |
| `of()`         | Táº¡o observable tá»« giÃ¡ trá»‹       |
| `from()`       | Táº¡o tá»« Promise, Iterable,...    |
| `interval()`   | Táº¡o timer phÃ¡t giÃ¡ trá»‹ liÃªn tá»¥c |
| `timer()`      | PhÃ¡t giÃ¡ trá»‹ sau delay          |
| `throwError()` | Táº¡o observable lá»—i              |
| `EMPTY`        | Táº¡o observable rá»—ng             |

## ğŸ” Biáº¿n Ä‘á»•i dá»¯ liá»‡u

| TÃªn            | MÃ´ táº£                                    |
| -------------- | ---------------------------------------- |
| `map()`        | Biáº¿n Ä‘á»•i giÃ¡ trá»‹ Ä‘áº§u ra                  |
| `pluck()`      | Láº¥y thuá»™c tÃ­nh con tá»« object             |
| `scan()`       | TÆ°Æ¡ng tá»± reduce (cÃ³ lÆ°u state)           |
| `buffer()`     | Gom cÃ¡c giÃ¡ trá»‹ thÃ nh máº£ng               |
| `concatMap()`  | Láº§n lÆ°á»£t gá»i observable tuáº§n tá»±          |
| `switchMap()`  | Há»§y observable cÅ©, dÃ¹ng cÃ¡i má»›i          |
| `mergeMap()`   | Gá»i song song nhiá»u observable           |
| `exhaustMap()` | Bá» qua náº¿u observable cÅ© chÆ°a hoÃ n thÃ nh |

## âœ… Lá»c giÃ¡ trá»‹

| TÃªn                      | MÃ´ táº£                                   |
| ------------------------ | --------------------------------------- |
| `filter()`               | Lá»c theo Ä‘iá»u kiá»‡n                      |
| `distinctUntilChanged()` | Chá»‰ phÃ¡t khi giÃ¡ trá»‹ thay Ä‘á»•i           |
| `take()`                 | Láº¥y N giÃ¡ trá»‹ Ä‘áº§u tiÃªn                  |
| `takeUntil()`            | Há»§y khi observable khÃ¡c phÃ¡t giÃ¡ trá»‹    |
| `first()`, `last()`      | Láº¥y giÃ¡ trá»‹ Ä‘áº§u/cuá»‘i                    |
| `debounceTime()`         | TrÃ¬ hoÃ£n xá»­ lÃ½ (thÆ°á»ng dÃ¹ng vá»›i search) |
| `throttleTime()`         | Giá»›i háº¡n tá»‘c Ä‘á»™ phÃ¡t giÃ¡ trá»‹            |
| `skip()`                 | Bá» qua N giÃ¡ trá»‹ Ä‘áº§u tiÃªn               |

## âš™ï¸ Káº¿t há»£p nhiá»u Observable

| TÃªn                | MÃ´ táº£                                         |
| ------------------ | --------------------------------------------- |
| `combineLatest()`  | Káº¿t há»£p giÃ¡ trá»‹ cuá»‘i cÃ¹ng tá»« nhiá»u observable |
| `forkJoin()`       | Äá»£i táº¥t cáº£ complete vÃ  tráº£ vá» káº¿t quáº£         |
| `withLatestFrom()` | Gá»™p observable chÃ­nh vá»›i observable phá»¥       |
| `zip()`            | GhÃ©p theo thá»© tá»± tá»« nhiá»u observable          |

## ğŸš¨ Xá»­ lÃ½ lá»—i

| TÃªn            | MÃ´ táº£                                    |
| -------------- | ---------------------------------------- |
| `catchError()` | Báº¯t lá»—i vÃ  thay tháº¿ báº±ng observable khÃ¡c |
| `retry()`      | Thá»­ láº¡i N láº§n náº¿u lá»—i                    |
| `retryWhen()`  | TÃ¹y biáº¿n logic retry nÃ¢ng cao            |

## ğŸ”„ KhÃ¡c

| TÃªn             | MÃ´ táº£                             |
| --------------- | --------------------------------- |
| `tap()`         | Side effect (log, debug...)       |
| `finalize()`    | Gá»i khi observable complete/error |
| `delay()`       | TrÃ¬ hoÃ£n phÃ¡t giÃ¡ trá»‹             |
| `shareReplay()` | Chia sáº» observable Ä‘Ã£ phÃ¡t        |

# ğŸ§© Component Best Practices vá»›i RxJS trong Angular

```ts
import { Component, OnInit, OnDestroy } from "@angular/core";
import { Subject, Observable, of } from "rxjs";
import {
  catchError,
  takeUntil,
  tap,
  switchMap,
  filter,
  map,
  shareReplay,
} from "rxjs/operators";
import { MyService } from "./my.service";
import { MyData } from "./my-data.interface";

@Component({
  selector: "app-my-component",
  templateUrl: "./my-component.component.html",
  styleUrls: ["./my-component.component.scss"],
})
export class MyComponent implements OnInit, OnDestroy {
  data$!: Observable<MyData[]>;

  private destroy$ = new Subject<void>();

  constructor(private myService: MyService) {}

  ngOnInit(): void {
    this.data$ = this.myService.getData().pipe(
      filter((data) => !!data),
      map((data) =>
        data.map((item) => ({ ...item, name: item.name.toUpperCase() }))
      ),
      tap(() => console.log("Fetched data")),
      catchError((error) => {
        console.error("Error fetching data", error);
        return of([]);
      }),
      shareReplay(1),
      takeUntil(this.destroy$)
    );

    // example if you need to subscribe manually:
    // this.data$.subscribe(data => {
    //   // do something with data
    // });
  }

  ngOnDestroy(): void {
    this.destroy$.next();
    this.destroy$.complete();
  }
}
```

---

## ğŸ“Œ CÃ¡c RxJS Operators ÄÃ£ DÃ¹ng

| RxJS Operator | Má»¥c Ä‘Ã­ch                                                                             |
| ------------- | ------------------------------------------------------------------------------------ |
| `takeUntil`   | Há»§y observable khi component bá»‹ destroy Ä‘á»ƒ trÃ¡nh memory leak                         |
| `catchError`  | Báº¯t lá»—i vÃ  tráº£ fallback observable (`of([])`)                                        |
| `tap`         | Thá»±c hiá»‡n side-effect nhÆ° log dá»¯ liá»‡u                                                |
| `switchMap`   | Chuyá»ƒn Ä‘á»•i tá»« observable nÃ y sang observable khÃ¡c, thÆ°á»ng dÃ¹ng khi gá»i API phá»¥ thuá»™c |
| `filter`      | Lá»c giÃ¡ trá»‹ khÃ´ng mong muá»‘n                                                          |
| `map`         | Biáº¿n Ä‘á»•i dá»¯ liá»‡u                                                                     |
| `shareReplay` | Chia sáº» observable Ä‘á»ƒ trÃ¡nh gá»i láº¡i API khi cÃ³ nhiá»u subscriber                      |

---

## ğŸ§© Interface nÃªn dÃ¹ng

```ts
export interface MyData {
  id: number;
  name: string;
  // cÃ¡c thuá»™c tÃ­nh khÃ¡c
}
```
