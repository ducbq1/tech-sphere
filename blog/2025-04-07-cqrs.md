---
slug: cqrs
title: CQRS (Command Query Responsibility Segregation)
authors: [ducbq1]
tags: [cqrs, database]
---
# ğŸ“˜ CQRS (Command Query Responsibility Segregation)

CQRS (Command Query Responsibility Segregation) lÃ  má»™t máº«u kiáº¿n trÃºc giÃºp **tÃ¡ch biá»‡t rÃµ rÃ ng giá»¯a pháº§n Ä‘á»c dá»¯ liá»‡u (Query)** vÃ  **ghi dá»¯ liá»‡u (Command)** trong á»©ng dá»¥ng. Äiá»u nÃ y giÃºp cáº£i thiá»‡n hiá»‡u nÄƒng, kháº£ nÄƒng má»Ÿ rá»™ng vÃ  tÃ­nh báº£o trÃ¬ cá»§a há»‡ thá»‘ng.



<!-- truncate -->


---

## ğŸ“Œ 1. Tá»•ng Quan

* **Command** : Ghi dá»¯ liá»‡u (Insert, Update, Delete)
* **Query** : Äá»c dá»¯ liá»‡u (SELECT)

> TÃ¡ch biá»‡t Ä‘á»ƒ dá»… tá»‘i Æ°u hÃ³a tá»«ng pháº§n cho má»¥c tiÃªu khÃ¡c nhau.

![1744028749182](image/2025-04-07-cqrs/1744028749182.png)

## âš™ï¸ 2. Kiáº¿n TrÃºc CQRS

```
[Client]
   â”‚
   â”œâ”€â”€> [Command API] â”€â”€> [Command Handler] â”€â”€> [Write DB]
   â”‚
   â””â”€â”€> [Query API] â”€â”€â”€â”€> [Query Handler] â”€â”€â”€> [Read DB]
```

* **Write DB** cÃ³ thá»ƒ lÃ  má»™t schema hoáº·c há»‡ thá»‘ng riÃªng biá»‡t.
* **Read DB** cÃ³ thá»ƒ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a cho hiá»‡u suáº¥t truy váº¥n.

---

## âœ… 3. Æ¯u Äiá»ƒm

* ğŸ”„ TÃ¡ch biá»‡t rÃµ rÃ ng xá»­ lÃ½ Ä‘á»c vÃ  ghi
* ğŸš€ Tá»‘i Æ°u hiá»‡u nÄƒng Ä‘á»c/ghi Ä‘á»™c láº­p
* ğŸ”§ Dá»… má»Ÿ rá»™ng, dá»… scale tá»«ng pháº§n
* ğŸ” TÄƒng cÆ°á»ng báº£o máº­t vÃ  kiá»ƒm soÃ¡t

---

## âš ï¸ 4. NhÆ°á»£c Äiá»ƒm

* ğŸ§© TÄƒng Ä‘á»™ phá»©c táº¡p há»‡ thá»‘ng
* ğŸ”„ Cáº§n Ä‘á»“ng bá»™ giá»¯a Read DB vÃ  Write DB (eventual consistency)
* ğŸ§ª Phá»©c táº¡p hÆ¡n khi test vÃ  debug

---

## ğŸ› ï¸ 5. Khi NÃ o DÃ¹ng CQRS?

| TÃ¬nh huá»‘ng                                        | CÃ³ nÃªn dÃ¹ng CQRS?  |
| --------------------------------------------------- | --------------------- |
| Há»‡ thá»‘ng Ä‘Æ¡n giáº£n                              | âŒ KhÃ´ng cáº§n thiáº¿t |
| á»¨ng dá»¥ng cÃ³ nhiá»u Ä‘á»c hÆ¡n ghi                | âœ… PhÃ¹ há»£p          |
| YÃªu cáº§u hiá»‡u nÄƒng cao                           | âœ… NÃªn dÃ¹ng         |
| Dá»¯ liá»‡u phá»©c táº¡p vÃ  thay Ä‘á»•i thÆ°á»ng xuyÃªn | âœ… Ráº¥t phÃ¹ há»£p     |

---

## ğŸ” 6. So SÃ¡nh Vá»›i CRUD

| TiÃªu chÃ­          | CRUD | CQRS |
| ------------------- | ---- | ---- |
| Gá»™p chung xá»­ lÃ½  | âœ…   | âŒ   |
| TÃ¡ch biá»‡t xá»­ lÃ½ | âŒ   | âœ…   |
| ÄÆ¡n giáº£n         | âœ…   | âŒ   |
| Hiá»‡u nÄƒng cao     | âŒ   | âœ…   |

---

## ğŸ”„ 7. Káº¿t Há»£p Vá»›i Event Sourcing

CQRS thÆ°á»ng Ä‘Æ°á»£c káº¿t há»£p vá»›i **Event Sourcing** Ä‘á»ƒ lÆ°u trá»¯ toÃ n bá»™ cÃ¡c sá»± kiá»‡n xáº£y ra thay vÃ¬ tráº¡ng thÃ¡i hiá»‡n táº¡i. Äiá»u nÃ y giÃºp:

* KhÃ´i phá»¥c láº¡i dá»¯ liá»‡u á»Ÿ báº¥t ká»³ thá»i Ä‘iá»ƒm nÃ o
* Audit dá»… dÃ ng

![1744028799715](image/2025-04-07-cqrs/1744028799715.png)

![1744028693803](image/2025-04-07-cqrs/1744028693803.png)

## ğŸ“š TÃ i Liá»‡u Tham Kháº£o

* [Martin Fowler on CQRS](https://martinfowler.com/bliki/CQRS.html)
* [Microsoft CQRS Docs](https://docs.microsoft.com/en-us/azure/architecture/patterns/cqrs)
* [EventStore CQRS](https://eventstore.com/cqrs/)

---

> ğŸ§  *CQRS lÃ  cÃ´ng cá»¥ máº¡nh máº½, nhÆ°ng khÃ´ng pháº£i lÃºc nÃ o cÅ©ng cáº§n thiáº¿t. HÃ£y cÃ¢n nháº¯c ká»¹ trÆ°á»›c khi Ã¡p dá»¥ng.*
